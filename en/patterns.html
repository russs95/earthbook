<!DOCTYPE html>
<html lang="en">
<HEAD>
<title>Patterns of Process | Tractatus Ayyew - An Earthbook</title>
<meta charset="UTF-8"> 


<!--
o               .        ___- -___                    .                   
       .              .-\          -.     .     .         .
                    ./.;_.\     __/~ \.     
                   /;  / `-'  __\    . \                            
 .        .       / ,--'     / .   .;   \        |
                 | .|       /       __   |      -O-       .
                |__/    __ |  . ;   \ | . |      |
                |      /  \\_    . ;| \___|    
   .    o       |      \  .~\\___,--'     |           .
                 |     | . ; ~~~~\_    __|
    |             \    \   .  .  ; \  /_/   .
   -O-        .    \   /         . |  ~/                  .
    |    .          ~\ \   .      /  /~          o
  .                   ~- ___ ; ___-~       
                 .          -_-         .              -JT


EARTHBOOK - An open source, Earth & Human Friendly Book format
Read the book.  Improve, translate or comment on the content.  Or fork the code and publish your own.  
 

Landing page - version 1.3
Created by Russell Maier as a publishing format that fully embodies the principles of Earthen ethics to enable net-green book publishing.
First EarthBook, the Tractatus Ayyew, published 22.12.22.

License: GNU General Public License v2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html
All files, unless otherwise stated, are released under the GNU General Public
License version 2.0 (https://www.gnu.org/licenses/gpl-2.0.html)
See full project repository at: https://github.com/russs95/earthbook
For the principles behind the Earthbook see the Tractatus Ayyew:  https://book.earthe.io
*/
-->
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/favicon-16x16.png">
<!--<link rel="manifest" href="../favicons/site.webmanifest">-->

<link rel="canonical" href="https://book.earthen.io/en/patterns.html"> 
<link rel="alternate" href="https://book.earthen.io/en/patterns.html" hreflang="en" >
<link rel="alternate" href="http://book.earthen.io/en/patterns.html" hreflang="x-default" >
<link rel="alternate" href="https://book.earthen.io/fr/plastique1.html" hreflang="fr" >
<!--
<link rel="alternate" href="https://book.earthen.io/es/" hreflang="es" >
<link rel="alternate" href="https://book.earthen.io/id/" hreflang="id" >-->



<!--BOOK META TAGS
These tags will be consistent for the whole book-->

<meta name="keywords" content="patterns of process, cosmological character, planetary patterns, pattern, patterns, blocks, judgements, despair, depletion, enrichment, plastic, carbon emissions, petro-capital economy, human nature, nature of plastic, jevon's paradox, jevon"> 
<meta name="description" content="Observing our and Earth's evolution we can discern two patterns at play.  Rather than be mired in self-judgment at our play with carbon, we can be dazzled by Earth’s.">
	
<meta property="article:publisher" content="Earthen.io" >
<meta name="author" content="Russell Maier & Banayan Angway">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="article:modified_time" content="2023-8-07T09:14:13+00:00" >
  
<!-- Facebook Open Graph Tags for social sharing-->
<meta property="og:site_name" content="An Earthen Ethic - Tracatus Ayyew">
<meta property="article:publisher" content="Earthen.io" >
<meta property="og:type"          content="book">
<meta property="og:title"         content="Patterns of Process - Tractatus Ayyew | An Earthen Ethics">
<meta property="og:description"   content="Observing our and Earth's evolution we can discern two patterns at play.  Rather than be mired in self-judgment at our play with carbon, we can be dazzled by Earth’s.">
<meta property="og:image"         content="https://book.earthen.io/covers/earth-book-cover-1000px.jpg">
<meta property="og:image:type" content="image/png" >
<meta property="og:image:width" content="1000px" >
<meta property="og:image:height" content="1500px" >
<meta property="og:locale" content="en_EN" >
<meta property="og:url" content="https://book.earthen.io/en/patterns.html">

<script>
      // Declare the global variables
     var book = "Book One";
    var chapNo = "4";
    var chapName = "Patterns of Process";
    var chaptURL = "patterns.html"   // Declare the global variables
  

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('../service-worker.js?v=2').then(function(registration) {
          console.log('ServiceWorker registration successful with scope:', registration.scope);
        }, function(error) {
          console.log('ServiceWorker registration failed:', error);
        });
      });
    }


    
</script>



 <!--FONTS
starts loading the fonts-->

<link rel="preconnect" href="../fonts/">
<link rel="preconnect" href="../fonts/" crossorigin> 

<!-- PRELOADS-->
<link rel="preload" as="image" href="../svgs/00-imagine-dark.svg">
<link rel="preload" as="image" href="../svgs/00-imagine-white.svg">


 <!-- STYLE SHEETS   
All the css needed for this page-->
 
<link rel="stylesheet" href="../style-sheet.css">
<link rel="stylesheet" href="../stylesheet-chapter.css?v=1.3">
<link rel="stylesheet" href="../light.css">
<link rel="stylesheet" href="../light.css" media="(prefers-color-scheme: light)">
 <link rel="stylesheet" href="../dark.css" media="(prefers-color-scheme: dark)">
 <link rel="stylesheet" href="../slider.css">

 
 <!-- INCLUDES
 Main Scripts-->   
 <script type="module" src="../dark-mode-toggle.mjs.js" async></script>
 <script src="../universal-javascript.js" defer></script>
 <script src="../content-javascript.js?v=2.2" defer></script>
 <script src="../clip/dist/clipboard.min.js" defer></script>
 <!--Carbon Badge script
 <script src="../b.min.js" defer></script>
 <script src="https://unpkg.com/website-carbon-badges@1.1.3/b.min.js?v=2" defer></script>
-->

 
 <!-- Arc CDN Script without delay
<script async src="https://arc.io/widget.min.js#Z7EC7Cze"></script>-->

 <!--PAGE INCLUDES
All the page components required to build this page-->

<!--1--><script src="includes/header-component.js"  async></script>
<!--2--><script src="includes/settings-curtain.js"  defer></script>
<!--3--><script src="includes/content-curtain.js"  defer></script>
<!--4--><script src="includes/share-curtain.js"  defer></script>
<!--5--><script src="includes/buy-curtain.js"  defer></script>
<!--6--><script src="includes/bookplate-curtain.js"  defer></script>
<!--7--><script src="includes/earthbook-curtain.js"  defer></script>
<!--8--><script src="includes/footer-component.js" defer></script>
<!--9--><script src="includes/read-curtain.js" defer></script>
<!--10--><script src="includes/tour-curtain.js"  defer></script>
<!--11--><script src="includes/search-curtain.js"  defer></script>
<!--12--><script src="includes/eco-curtain.js"  defer></script>
<!--13--><script src="includes/chap-foot.js?V=2" defer></script>
<!--14--><script src="includes/booknotes-curtain.js?v=2" defer></script>


<style>



@font-face {
  font-family: "CooperLt";
  font-style: normal;
  src: url("../fonts/CooperLightBT.ttf");
  font-display: swap;
 }

 @font-face {
  font-family: "CooperLt";
  font-style: italic;
  src: url("../fonts/CooperLtBTLightItalic.ttf");
  font-display: swap;
 }

 @font-face {
  font-family: "CooperLtMedium";
  src: url("../fonts/CooperMediumBT.ttf");
  font-display: swap;
 }

 @font-face {
  font-family: "Mulish";
  src: url("../fonts/Mulish-Light.ttf");
  font-display: swap;
 }

 #ct-chapter-title {
      font-size: 10vmin;
      letter-spacing: 2px;
      
    }


</style>
</HEAD>

<BODY class="accessibility-plugin-ac">

<!--TOUR-CURTAIN-->
<tour-curtain></tour-curtain>


  <div id="underlayer">

    <div id="top"></div>

<!--HEADER NAVBAR-->
<header-component></header-component>


<div id="ct-chapter-top">
  <button type=button id="ct-tc-menu" onclick="openContents()"  aria-label="Open Table of Contents"></button>
  <div class="ct-holder" style="cursor:pointer;" onclick="openContents()">
    <div id="ct-chapter-title">Patterns <i style="font-variant-caps:normal; font-size:0.8em">of</i> Process</div>   
    <div id="ct-book-title">Tractatus Ayyew</div>
    <div id="ct-chap-location">Book One | Chapter Four</div>
    <div id="ct-word-count"><i>837 words</i></div>
  </div>
</div> 

<!-- Page Title Section-->

<div id="ct-chapt-graphic" class="background-4">

</div>


<div id="up-arrow"></div>

<div id="ct-main">



<!-- MAIN TEXT CONTENT of the Page
  For footnotes, use these numbers:  ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁰  “ ” ¹⁰ ¹³
-->
<div class="lead-page-paragraph" id="en-1-4-00">
    OVER THE LAST FOUR BILLION YEARS, the singular combination of our planet's orbit, spin, composition and chemistry has played out.  As this unique configuration of matter and energy has unfolded, a once barren rock has transformed into the thriving biosphere that is our common home today.  Of all that we know of other planets in our solar system and galaxy, it is an extraordinary and epic story.  However, even more remarkable, the telling of the tale is now part of the story itself.
 </div>




 <div id="chap-notice">
    <div id="close-notice" onclick="closeWelcomeNotice()">&times;</div>
    <div id="chap-notice-text">
      Looks like its your first time opening this book!  Before you get going, consider taking the quick <a class="java-link" onclick="guidedTour(), closeWelcomeNotice()" aria-label="Open About Screen" title="Learn more about what an Earthbook is">Earthbook features tour</a> and be sure to <a class="java-link" onclick="openSettings(), closeWelcomeNotice()" aria-label="Open Settings" title="Adjust for your eyes">optimize ±</a> the page for your eyes.
    </div>
    </div>


<div class="page-paragraph">

<p id="en-1-4-01">The telling of Earth's tale is only possible through a vast and unique confluence of matter and energy; the spiral of carbon into ever more concentrated and complex configurations, the dispersion of the sun's energy into ever more diverse organisms and ecosystems; and through it all the inexorable unfolding of sentience in a myriad of forms.  Powered by ancient compacted carbon, our last centuries of civilization and science have been able to illuminate both Earth’s story and our own.</p>

  <p id="en-1-4-2">From this vast vantage we must revisit our judgments of ourselves and of plastic.</p>


  <p id="en-1-4-3">Rather than be mired in despair at our modern moment of ecological depletion we can be awed by Earth’s momentous act of ecological enrichment.</p>

  <p id="26-up">The way our planet— <i>as a uniquely configured cosmological system</i>— has managed its matter and energy has led to the steady greening of its surface; the cultivation of ever greater diversity, vibrancy and abundance.<a href="#footnotes" onclick="openFootnotes()" title="Going forward we will refer to Earth in ways that imply agency (i.e. “Earth managed its matter”). While it is more than possible to conceive Earth as a sentient entity, a divine being, or the active creation of a divine being(s), such claims are beyond the scope of this essay. Instead we imply agency simply in as much as any singular self-contained system has its own unique patterns, character and tendencies.  i.e. “Big Ben kept time”, “Everest stood tall”, “Uranus spins slowly around the sun”." onclick="openFootnotes()">²⁶</a>  And finally, through the resulting emergence of consciousness, we have been propelled to pondering the process itself.</p>

  <p id="en-1-4-04">So, where do we go from here?</p>

  <p id="en-1-4-05">First, let us hold fast to our vantage and the vast view it affords.</p>

  <p id="27-up">From here we can observe another pivotal planetary phenomenon. Aside from meteor strikes and massive volcanoes, it is a phenomenon unseen on the planet for millions of years.  Due to the doings of modern humanity, it has been eons since Earth’s processes, cycles and systems so abruptly added more carbon into the atmosphere than they removed.<a href="#footnotes" onclick="openFootnotes()" title="'The present atmospheric content [of CO2] exceeds anything Earth has experienced in the last million years and possibly the last 20 million years' David Beerling, 'The Emerald Planet' (Oxford University Press, 2017).">²⁷</a></p>

  <p id="en-1-4-06">The ensuing decline of the vitality and diversity of the biosphere is a direct challenge to our last century of carbon play.</p>

  <p id="en-1-4-07">Much like a child building with blocks for the first time, we have much to learn from our moment. All too often, youngsters are swept away by the thrill of assembling a grand construction. However, when the pieces inevitably tumble down, when the results aren’t as intended, the upset child invariably blames themselves and the blocks.</p>

  <p id="en-1-4-08">Of course, neither are to blame.</p>
  
  <p id="en-1-4-09">Only through the first fall can one grasp the process of the play.</p>

  <p id="en-1-4-10">There is no other way.</p>

 <p id="28-up">Likewise, our disruption of ecological cycles is not a consequence of our nature any more than it is the nature of carbon or oxygen.<a href="#footnotes" onclick="openFootnotes()" title="Are humans inherently destructive or contributory?  Competitive or collaborative?  In the chapters ahead, we take a firm position in this ongoing debate:  in discarding the empirically and rationally untenable view of humans as central and exceptional to the biosphere, and instead as subsets systems within it, our Earthen character becomes clear.  See:  Rutger Bregman, 'Humankind: A Hopeful History' (Little, Brown and Company, 2019).">²⁸</a>  Rather, it is the way of our play: the fundamental pattern by which our processes have managed their energy and their matter. </p>

 <p id="29-up">As we saw in plastic’s story, our modern processes have increasingly intended patterns of energy and matter that have dispersed carbon, concentrated energy, reduced biodiversity and stifled ecological awareness.  In sharp contrast, Earth's processes have tended towards just the opposite:  the concentration of carbon, the dispersal of energy, the increase of diversity and the cultivation of consciousness. Whereas our modern pattern of process has degraded ecosystems, Earth’s has systematically enriched them— making them ever more diverse, vibrant and abundant.<a href="#footnotes" onclick="openFootnotes()" title="Here and throughout the Tractatus Ayyew, we refer to the cumulative four billion years of the Earth’s history. Over the full period of Earth’s history, there have been tremendous swings in the abundance and diversity of the biosphere– extinctions, depletion and lulls where for millions of years life was severely stifled. However, despite these declines, we observe that on the whole the net-biodiversity and abundance of the biosphere has steadily increased.  We will examine each facet of the planet’s net-enrichment in the five chapters of book 2.">²⁹</a></p>

 <p id="30-up">Like a despairing and determined child on a second-go at block building, we’re trying harder than ever. With a shame at our failings, we have our heads down, striving valiantly to build stronger and higher: to make our processes less marmful, less polluting, less degrading, less grey. However, no matter how hard we have striven, our polluting has increased unabated for, over time, any improvements in the efficiency of our grey processes have been inevitably eclipsed by their proliferation. For with the underlying grey pattern of our processes unchanged, even if they are less depleting— <i>depleting they remain</i>.<a href="#footnotes" onclick="openFootnotes()" title="Hope is often placed on increases in efficiency to decrease the cumulative environmental impact of human processes (i.e. “more efficient coal powered steam engines will decrease London’s pollution”). However, historically, advances in technological efficiency have in fact resulted in increased environmental impact.  This is known as Jevon’s Paradox: as efficiency increases, so too does the adoption and spread of the technology, inevitably leading to a net-increase in environmental impact.  Our argument is complimentary: we observe that processes, cycles and systems have an inherent pattern that will unfold regardless of efficiency or scale.">³⁰</a></p>

 <p id="en-1-4-11">Banayan and I have come to see that it is time to raise our heads from the toil.</p>

 <p id="en-1-4-12">And the judgment.</p>

 <p id="en-1-4-13">Again, rather than despair, we can be awed.</p>

 <p id="en-1-4-14">Our once-in-a-million-years phenomenon of additive carbon usage is in fact a tremendous opportunity.</p>

 <p id="en-1-4-15">For the first time, with our usage of carbon as a foil, the difference between our modern ways and of Earth’s can be observed with unprecedented clarity.  In the stark contrast of patterns, we can begin to discern the planetary cosmological character that has propelled the inexorable transformation of a barren rock into a thriving biosphere: the pattern by which Earth has managed its matter and energy through processes, cycles and systems towards the enrichment of all.</p>

 <p id="31-up">And in a similar way, through our modern society’s ecological dissonance, so too can our modern gaze now recognize those societies—  ancient and ongoing— that have long attained resonance with Earth’s pattern and character.<a href="#footnotes" onclick="openFootnotes()" title="See Banayan’s work laying out a the context and definition of the Igorot Ayyew Ethos:  Banayan Angway, 'Cordillera Administrative Region Indigenous Peoples Education Curriculum K-12' (Bontoc, Mountain Prov., CAR; Philippines Department of Education, 2014).">³¹</a></p>

 <p id="en-1-4-16">Nations that just by thriving, enriched the vitality, diversity and abundance of the ecosystems of which they were part.</p>

 <p id="en-1-4-17">Nations that— just like Earth— cultivated common homes for one and for all.</p>

 
 <br><br>


</div><!--closes page text content-->

<!-- BOOKNOTES BUTTON-->

<div id="bookNotePalette" class="palette-hidden">
    <!--<span id="closePalette"><img src="../svgs/right-x.svg" alt="Close page button" width="50"></span>  -->
    <button id="highlightSaveButton" class="pallette-btn">Highlight</button>
    <button id="copyBtn" class="pallette-btn"><img src="../icons/copy.svg" alt="Close page button" height="20px"></button> 
    <button id="booknotesBtn" class="pallette-btn"><img src="../icons/booknotes.svg" alt="Close page button" height="20px"></button>
    <button id="cancelBtn" class="pallette-btn"><img src="../svgs/right-x.svg" alt="Close page button" height="20"></button>
</div>


   
<!--FOOTNOTES SECTION-->

  <div class="footnote-section" style="z-index:8;">

    <div class="footnote-line" style="border-style: dotted; border-color: grey; border-width: 1px; margin-bottom: 20px; width:100%; text-align:left;"></div>

    <div id="footnotes" style="cursor:pointer;display:flex;font-variant-caps: all-petite-caps; color:grey;" onclick="openFootnotes()">
          
      <div id="footnotes-arrow"></div>
      
      <div class="footnotes-title">Chapter Footnotes</div>
    
    </div>

    <div id="footer-reveal-container" style="height:200px;transition:0.4s;" >

      <div id="footnotes-reveal" style="height:200px; overflow-y: clip; transition:0.4s;margin-bottom:0px;transition-delay: 0.4s;">
      
        
        <a href="#13-up" class="footnote">   
        <div class="footnote-number">13.</div>
        <div class="footnote-text">Guido Tonelli, Genesis: The Story of How Everything Began, trans. Erica Segre, Simon Carnell (Farrar, Straus and Giroux, 2021)</div>
        </a>

        <a href="#14-up" class="footnote">   
        <div class="footnote-number">14.</div>
        <div class="footnote-text">“Atmospheric CO2 levels are estimated to have been 100 times what they are today 2.2 billion years ago”.  Rye, R., Kuo, P.HO., and Holland, H.D., Atmospheric carbon dioxide concentrations before 2.2 billion years ago. (Nature,  1995), 379, 6013-75. </div>
        </a>

        <a href="#15-up" class="footnote">   
        <div class="footnote-number">15.</div>
        <div class="footnote-text">“The earth is more like an eddy in a river through which flows of matter continuously stream. It is replenished and depleted in a vortical cosmic dance.” Thomas Nail, Theory of the Earth (Stanford University Press, 2021).
        </div>
        </a>

        <a href="#16-up" class="footnote">   
        <div class="footnote-number">16.</div>
        <div class="footnote-text">Dylan T. Holden, Nicolás M. Morato, and R. Graham Cooks, Aqueous microdroplets enable abiotic synthesis and chain extension of unique peptide isomers from free amino acids (Proceedings of the National Academy of Sciences, Vol. 119 | No. 42, October 18, 2022)</div>
        </a>

        <a href="#16-up" class="footnote">   
        <div class="footnote-number" id="3-down">17.</div>
        <div class="footnote-text">This view is inspired by our ayyew interpretation of the biological implications of the second law of thermodynamics. We’ll go much deeper into this into Chapter 7.  See: Jeremy L. England et al. (2015), Dissipative adaptation in driven self-assembly (Nature Nanotechnology, 2015). </div>
        </a>

        <a href="#18-up" class="footnote">   
        <div class="footnote-number" id="3-down">18.</div>
        <div class="footnote-text">The events of the first 3.5 billion years of evolution are coming to light at last and they include far more drama and intrigue than we ever imagined”  Michael Marshall, In the beginning: The full story of life on Earth can finally be told. (NewScientist, 2019).</div>
        </a>

        <a href="#19-up" class="footnote">   
        <div class="footnote-number" id="3-down">19.</div>
        <div class="footnote-text">Bekker, A., Holland,Wang, P. et al., Dating the rise of atmospheric oxygen, (Nature, 2004) 427, 117-20. </div>
        </a>

        <a href="#20-up" class="footnote">   
        <div class="footnote-number" id="3-down">20.</div>
        <div class="footnote-text">Our research indicates that 4-14% of crude oil that is processed cannot be refined into fuels.  This rate various with the geological source and chemical composition of the crude.  See: UK Oil consumption, (British Plastics Federation, 2008), Ref PD/LFH/19/8/08. Also: Russell Maier, Ani Himawati, The Rise of the Regenerative Ecobrick Movement, (Le Havre University: Bandung Spirit Conference, 2019).</div>
        </a>

        <a href="#20-up" class="footnote">   
        <div class="footnote-number" id="3-down">21.</div>
        <div class="footnote-text">“Oil refineries run 24-7 and are continuously generating by-products that must be disposed of, such as ethylene gas... propylene,  acrylonitrile [and other chemicals which are ideal for making plastic].  Plastics are a small piece of the petroleum industry, representing a minor fraction of the fossil fuels we consume.  But the economic imperatives of the petroleum industry have powered the rise of Plasticville.” Susan Freinkel, Plastic: A Toxic Love Story, (Houghton Mifflin Publishing Company, 2011), p7.   </div>
        </a>

  
        <a href="#22-up" class="footnote">   
        <div class="footnote-number">22.</div>
        <div class="footnote-text">With the rise in popularity of billiards during the 1850’s African elephants were being slaughtered en masse for their ivory to produce balls.  A competition to find an alternative material inspired the first experiments with petroleum by-products.</div>
        </a>

      
      <a href="#22-up" class="footnote">   
      <div class="footnote-number">23.</div>
      <div class="footnote-text">Plastics revolutionized the early photography industry that was severely limited by bulky and expensive equipment, enabling picture taking to become a household activity.</div>
      </a>

      
      <a href="#22-up" class="footnote">   
      <div class="footnote-number">24.</div>
      <div class="footnote-text">Transparent plastic film, originally developed by the cigarette industry, came to dramatically increase the shelf life of fresh foods.  Carmen Nobel, How Cellophane Changed the Way We Shop for Food, (Harvard Business School, 2017).</div>
      </a>

      <a href="#25-up" class="footnote">   
    <div class="footnote-number">25.</div>
    <div class="footnote-text">Observing plastic pollution and extreme weather are taking a growing emotional toll. Beyond Storms & Droughts: The Psychological Impacts of Climate (American Psychologists Association, 2014).  And:  Mental Health and Our Changing Climate: Impacts, Implications, and Guidance  (American Psychologists Association, 2017).</div>
    </a>

    <a href="#25-up" class="footnote">   
    <div class="footnote-number">25.</div>
    <div class="footnote-text">"Our study is the first indication that we have polymer particles in our blood." Heather A. Leslie, et al, <i>Discovery and quantification of plastic particle pollution in human blood</i> (Environment International, 2022) Volume 163, 107199, ISSN 0160-4120</div>
    </a>



    

       

    </div>
  </div>



    <div id="footnotes-concealer"></div>

    </div><!--Closes footnote section-->
          
  </div><!--Closes main content block-->



    <!--BOOKNOTES-CURTAIN-->
    <booknotes-curtain></booknotes-curtain>

<!--SEARCH-CURTAIN-->
<search-curtain></search-curtain>

<!--CONTENTS MENU-->
<content-curtain></content-curtain>

<!--SETTINGS-MENU-->
<settings-curtain></settings-curtain>

<!--BOOK PLATE-->
<bookplate-curtain></bookplate-curtain>

<!--ABOUT EARTHBOOK-->
<earthbook-curtain></earthbook-curtain>

<!--SHARE-MENU-->
<share-curtain></share-curtain>

<!--BUY-CURTAIN-->
<buy-curtain></buy-curtain>

<!--ECO-CURTAIN-->
<eco-curtain></eco-curtain>


<!--FOOTER Next Chapter Section: Requires customization-->
  <div id="footer-chapter" style="margin-bottom: 0px;">

    <div class="footer-size">
    
      <div class="footer-left">

       <!-- <div id="footer-icon-left" style="cursor:pointer;" onclick="openFooter()"></div>-->

     
        <div class="next-section">
          <div class="next-sec">Next section:</div>
          <div class="sec-name"><i>Nature's Fallacy</i></div>
        </div>

      </div>
  
      <div class="footer-right">
    
        <a href="nature.html" title="Go to the next chapter" aria-label="Go to the next chapter"><div class="next-button">Next ➔</div></a>

      </div>
    </div>

<!-- CHAPTER FOOTER-->


<chap-foot></chap-foot>



</div><!--underlayer-->

<script>

    
function checkSelectedText() {
    const selection = window.getSelection();

    // Check if any text is selected
    if (!selection.rangeCount || selection.isCollapsed) {
        return;
    }

    const selectedRange = selection.getRangeAt(0);
    const startContainerParent = selectedRange.startContainer.parentNode;
    const endContainerParent = selectedRange.endContainer.parentNode;

    // Check if the selection is within the #ct-main element
    const ctMainElement = document.getElementById('ct-main');
    if (!ctMainElement.contains(startContainerParent) || !ctMainElement.contains(endContainerParent)) {
        return;
    }

    // Check if the selection does not span more than one paragraph
    if (startContainerParent !== endContainerParent) {
        return;
    }

    saveBookNotePalette();
}

document.addEventListener('mouseup', checkSelectedText);
document.addEventListener('touchend', checkSelectedText);



/*
function checkSelectedText() {
    let selectedText = window.getSelection().toString();
    if (selectedText) { // If some text is selected
        saveBookNotePalette();
    }
}*/

document.addEventListener('mouseup', checkSelectedText);
document.addEventListener('touchend', checkSelectedText);



document.addEventListener('mouseup', function(e) {
    let selectedText = window.getSelection().toString();
    if (selectedText) { // If some text is selected
        saveBookNotePalette();
    }
});


function saveBookNotePalette() {
    const palette = document.getElementById('bookNotePalette');
    palette.style.bottom = '-30px'; // Slide up to show the palette
}


document.getElementById('cancelBtn').addEventListener('click', function() {
    const palette = document.getElementById('bookNotePalette');
    palette.style.bottom = '-200px'; // Slide down to hide the palette
});


document.getElementById('copyBtn').addEventListener('click', function() {
    let selectedText = window.getSelection().toString();
    copyToClipboard(selectedText);
});

function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);

    // Change button text and style
    const button = document.getElementById('copyBtn');
    button.style.color = 'green';
    button.textContent = '✓ Copied!';

    // Slide down and hide the palette
    setTimeout(() => {
        const palette = document.getElementById('bookNotePalette');
        palette.style.bottom = '-200px'; // Slide down to hide the palette

        // After an additional second, reset the button text
        setTimeout(() => {
            button.textContent = 'Copy';
            button.style.color = 'var(--text-color)';
        }, 1000);
    }, 800);
}





/*NEW HIGHLIGHT SYSTEM*/

let currentId = 0;

function generateId() {
    currentId += 1;
    return String(currentId).padStart(3, '0');
}

function highlightSaveBookNote() {
    const selection = window.getSelection();

    // If there's selected text
    if (selection.rangeCount > 0) {
        const selectedRange = selection.getRangeAt(0);

        // Create a span element, add the highlight class to it, and surround the selected text with it
        const span = document.createElement("span");
        span.classList.add("highlight");
        span.title = "Click to remove BookNote"; // Adding title attribute
        span.alt = "Highlight"; // Adding alt attribute

        // Generate and store a unique identifier
        const id = generateId();
        span.dataset.id = id;

        selectedRange.surroundContents(span);

        // Find the closest p ancestor for startContainer and endContainer
        let startContainerNode = selectedRange.startContainer;
        while (startContainerNode.nodeName !== 'P' && startContainerNode.parentNode !== null) {
            startContainerNode = startContainerNode.parentNode;
        }
        const startContainer = startContainerNode.id;

        let endContainerNode = selectedRange.endContainer;
        while (endContainerNode.nodeName !== 'P' && endContainerNode.parentNode !== null) {
            endContainerNode = endContainerNode.parentNode;
        }
        const endContainer = endContainerNode.id;

        const startOffset = selectedRange.startOffset;
        const endOffset = selectedRange.endOffset;
        const storedText1 = selection.toString();
        

        // Display an alert with the stored variables
        alert(
            `Start Container: ${startContainer}\n` +
            `End Container: ${endContainer}\n` +
            `Start Offset: ${startOffset}\n` +
            `End Offset: ${endOffset}\n` +
            `Stored Text: ${storedText1}`
        );

        const storedNoteText = selection.toString();
        const charCount = storedNoteText.length; // Counting characters
        const now = new Date();
        const BNdateTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}T${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        const noteChapter = chapName; // Using the global variable

        // Retrieve existing bookNotes from local storage
        let bookNotes = JSON.parse(localStorage.getItem('bookNotes')) || [];

        // New highlight object
        const bookNote = {
            id,
            book,
            chapNo,
            chapName,
            chaptURL,
            startContainer,
            startOffset,
            storedNoteText,
            noteChapter,
            charCount,
            BNdateTime
        };

        // Add the new highlight to the array
        bookNotes.push(bookNote);

        // Save the updated array back to local storage
        localStorage.setItem('bookNotes', JSON.stringify(bookNotes));

        // Log to console
        console.log('BookNote saved:', bookNote);

        // Clear the selection
        selection.removeAllRanges();

        // Update the button text
        const button = document.getElementById('highlightSaveButton');
        button.style.color = 'green';
        button.style.fontWeight = 'bold';
        button.textContent = '✓ Saved!';

        // Hide the palette after 1 second
        setTimeout(() => {
            const palette = document.getElementById('bookNotePalette');
            palette.style.bottom = '-200px'; // Slide down to hide the palette

            // After an additional second, reset the button text
            setTimeout(() => {
                const button = document.getElementById('highlightSaveButton');
                button.textContent = 'Highlight & Save';
                button.style.color = 'var(--text-color)';
                button.style.fontWeight = 'normal';
            }, 1000);
        }, 1000);
    }
}





document.getElementById('highlightSaveButton').addEventListener('click', highlightSaveBookNote);


function removeHighlight(event) {
    const element = event.target;
    
    if (element.classList.contains('highlight')) {
        const id = element.dataset.id;

        // Get the bookNotes from local storage
        let bookNotes = JSON.parse(localStorage.getItem('bookNotes')) || [];

        // Find the index of the bookNote with the given id
        const index = bookNotes.findIndex(bookNote => bookNote.id === id);

        if (index !== -1) {
            // If the bookNote was found, remove it
            bookNotes.splice(index, 1);

            // Save the updated array back to local storage
            localStorage.setItem('bookNotes', JSON.stringify(bookNotes));

            console.log('BookNote removal success');
        } else {
            console.log('BookNote removal failed');
        }

        // Remove the span tag
        const text = document.createTextNode(element.textContent);
        element.parentNode.replaceChild(text, element);
    }
}


// Add a click event listener to the document to call removeHighlight when a highlight span is clicked
document.addEventListener('click', removeHighlight);



function recreateSelection() {
    const bookNotes = JSON.parse(localStorage.getItem('bookNotes')) || [];

    bookNotes.forEach(note => {
        const { storedNoteText, startContainer, startOffset, id } = note;

        if (storedNoteText && startContainer && startOffset !== null && id) {
            try {
                // Find the element by the saved ID
                const container = document.getElementById(startContainer);

                if (container) {
                    // Traverse through text nodes to find the correct position
                    let node = container.firstChild;
                    let currentOffset = 0;

                    while (node) {
                        if (node.nodeType === Node.TEXT_NODE) {
                            if (currentOffset + node.length >= startOffset) {
                                break;
                            }
                            currentOffset += node.length;
                        }
                        node = node.nextSibling;
                    }

                    if (node) {
                        const range = document.createRange();
                        range.setStart(node, startOffset - currentOffset);
                        range.setEnd(node, startOffset - currentOffset + storedNoteText.length);

                        const span = document.createElement('span');
                        span.className = 'highlight';
                        span.textContent = storedNoteText;
                        span.dataset.id = id; // Reusing the same id
                        span.title = "Click to remove BookNote";

                        range.deleteContents();
                        range.insertNode(span);
                    } else {
                        console.error('Error: Stored text not found for the following book note:', note);
                    }
                } else {
                    console.error('Error: Container element not found for the following book note:', note);
                }
            } catch (err) {
                console.error('An error occurred while recreating selection for the following book note:', note);
                console.error(err);
            }
        } else {
            console.warn('Warning: Incomplete book note data. Ignoring the following book note:', note);
        }
    });
}
window.addEventListener('load', recreateSelection);

// Make sure this is after recreateSelection
document.addEventListener('click', removeHighlight);
</script>

</body>
</html>

