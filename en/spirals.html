<!DOCTYPE html>
<html lang="en">
<HEAD>
<title>Cycles that Spiral | Tractatus Ayyew - An Earthbook</title>
<meta charset="UTF-8"> 


<!--
o               .        ___- -___                    .                   
       .              .-\          -.     .     .         .
                    ./.;_.\     __/~ \.     
                   /;  / `-'  __\    . \                            
 .        .       / ,--'     / .   .;   \        |
                 | .|       /       __   |      -O-       .
                |__/    __ |  . ;   \ | . |      |
                |      /  \\_    . ;| \___|    
   .    o       |      \  .~\\___,--'     |           .
                 |     | . ; ~~~~\_    __|
    |             \    \   .  .  ; \  /_/   .
   -O-        .    \   /         . |  ~/                  .
    |    .          ~\ \   .      /  /~          o
  .                   ~- ___ ; ___-~       
                 .          -_-         .              -JT


EARTHBOOK - An open source, Earth & Human Friendly Book format
Read the book.  Improve, translate or comment on the content.  Or fork the code and publish your own.  
 

Landing page - version 1.3
Created by Russell Maier as a publishing format that fully embodies the principles of Earthen ethics to enable net-green book publishing.
First EarthBook, the Tractatus Ayyew, published 22.12.22.

License: GNU General Public License v2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html
All files, unless otherwise stated, are released under the GNU General Public
License version 2.0 (https://www.gnu.org/licenses/gpl-2.0.html)
See full project repository at: https://github.com/russs95/earthbook
For the principles behind the Earthbook see the Tractatus Ayyew:  https://book.earthe.io
*/
-->
<link rel="apple-touch-icon" sizes="180x180" href="../favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/favicon-16x16.png">
<!--<link rel="manifest" href="../favicons/site.webmanifest">-->

<link rel="canonical" href="https://book.earthen.io/en/spirals.html"> 
<link rel="alternate" href="https://book.earthen.io/en/spirals.html" hreflang="en" >
<link rel="alternate" href="http://book.earthen.io/en/spirals.html" hreflang="x-default" >
<link rel="alternate" href="https://book.earthen.io/fr/epigraphe-2.html" hreflang="fr" >
<!--
<link rel="alternate" href="https://book.earthen.io/es/" hreflang="es" >
<link rel="alternate" href="https://book.earthen.io/id/" hreflang="id" >-->



<!--BOOK META TAGS
These tags will be consistent for the whole book-->

<meta name="keywords" content="igorots, ayyew, cycles, spirals, energy, matter, entropy, thermodynamics, jeremy england, pigs, fertilizer, rice paddy, terraces, hydrologic, linear, circular, circular design, circular economy, plastic, recycling, degrading, enriching, grey, green, gray,  linear vs circular, circular"> 
<meta name="description" content="Observe the way Earth tends its processes towards cycles that spiral.">
	
<meta property="article:publisher" content="Earthen.io" >
<meta name="author" content="Russell Maier & Banayan Angway">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="article:modified_time" content="2023-8-07T09:14:13+00:00" >
  
<!-- Facebook Open Graph Tags for social sharing-->
<meta property="og:site_name" content="An Earthen Ethic | Tracatus Ayyew">
<meta property="article:publisher" content="Earthen.io" >
<meta property="og:type"          content="book">
<meta property="og:title"         content="Cycles that Spiral">
<meta property="og:description"   content="Observe the way Earth tends its processes towards cycles that spiral.">
<meta property="og:image"         content="https://book.earthen.io/covers/earth-book-cover-1000px.jpg">
<meta property="og:image:type" content="image/png" >
<meta property="og:image:width" content="1000px" >
<meta property="og:image:height" content="1500px" >
<meta property="og:locale" content="en_EN" >
<meta property="og:url" content="https://book.earthen.io/en/spirals.html">

<script>
      // Declare the global variables
     var book = "Book Two";
    var chapNo = "1";
    var chapName = "Cycles that Spiral";
    var chaptURL = "spirals.html"   // Declare the global variables
  

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('../service-worker.js?v=2').then(function(registration) {
          console.log('ServiceWorker registration successful with scope:', registration.scope);
        }, function(error) {
          console.log('ServiceWorker registration failed:', error);
        });
      });
    }


    
</script>



 <!--FONTS
starts loading the fonts-->

<link rel="preconnect" href="../fonts/">
<link rel="preconnect" href="../fonts/" crossorigin> 

<!-- PRELOADS-->
<link rel="preload" as="image" href="../svgs/08-cycles-dark.svg">
<link rel="preload" as="image" href="..svgs/08-cycles-white.svg">


 <!-- STYLE SHEETS   
All the css needed for this page-->
 
<link rel="stylesheet" href="../style-sheet.css">
<link rel="stylesheet" href="../stylesheet-chapter.css?v=1.3">
<link rel="stylesheet" href="../light.css">
<link rel="stylesheet" href="../light.css" media="(prefers-color-scheme: light)">
 <link rel="stylesheet" href="../dark.css" media="(prefers-color-scheme: dark)">
 <link rel="stylesheet" href="../slider.css">

 
 <!-- INCLUDES
 Main Scripts-->   
 <script type="module" src="../dark-mode-toggle.mjs.js" async></script>
 <script src="../universal-javascript.js" defer></script>
 <script src="../content-javascript.js?v=2.2" defer></script>
 <script src="../clip/dist/clipboard.min.js" defer></script>
 <!--Carbon Badge script
 <script src="../b.min.js" defer></script>
 <script src="https://unpkg.com/website-carbon-badges@1.1.3/b.min.js?v=2" defer></script>
-->

 
 <!-- Arc CDN Script without delay
<script async src="https://arc.io/widget.min.js#Z7EC7Cze"></script>-->

 <!--PAGE INCLUDES
All the page components required to build this page-->

<!--1--><script src="includes/header-component.js"  async></script>
<!--2--><script src="includes/settings-curtain.js"  defer></script>
<!--3--><script src="includes/content-curtain.js"  defer></script>
<!--4--><script src="includes/share-curtain.js"  defer></script>
<!--5--><script src="includes/buy-curtain.js"  defer></script>
<!--6--><script src="includes/bookplate-curtain.js"  defer></script>
<!--7--><script src="includes/earthbook-curtain.js"  defer></script>
<!--8--><script src="includes/footer-component.js" defer></script>
<!--9--><script src="includes/read-curtain.js" defer></script>
<!--10--><script src="includes/tour-curtain.js"  defer></script>
<!--11--><script src="includes/search-curtain.js"  defer></script>
<!--12--><script src="includes/eco-curtain.js"  defer></script>
<!--13--><script src="includes/chap-foot.js?V=2" defer></script>
<!--14--><script src="includes/booknotes-curtain.js?v=2" defer></script>


<style>



@font-face {
  font-family: "CooperLt";
  font-style: normal;
  src: url("../fonts/CooperLightBT.ttf");
  font-display: swap;
 }

 @font-face {
  font-family: "CooperLt";
  font-style: italic;
  src: url("../fonts/CooperLtBTLightItalic.ttf");
  font-display: swap;
 }

 @font-face {
  font-family: "CooperLtMedium";
  src: url("../fonts/CooperMediumBT.ttf");
  font-display: swap;
 }

 @font-face {
  font-family: "Mulish";
  src: url("../fonts/Mulish-Light.ttf");
  font-display: swap;
 }



 @media screen and (max-width: 699px) {
    .ct-chapter-quote {
      width: 87%;
      font-size: 1.4em;
    }
    .ct-quote-source {
      width: 80%;
      font-size: 0.8em;
    }
  }

  @media screen and (min-width: 700px) and (max-width: 1324px) {
    .ct-chapter-quote {
      width: 70%;
      font-size: 1.8em;
    }
    .ct-quote-source {
      width: 70%;
      font-size: 1em;
    }
  }
    
  @media screen and (min-width: 1325px) {
    .ct-chapter-quote {
    width: 50%;
    font-size: 2em;
    text-shadow: 0px 0px 12px var(--slider);
    }
    .ct-quote-source {
      width: 50%;
      font-size: 1em;
    }
  }

  #ct-chapter-title {
      /*padding-top: 45px;
      */font-size: 10vmin;
      letter-spacing: 2px;
      
    }

  
  


</style>
</HEAD>

<BODY class="accessibility-plugin-ac">

<!--TOUR-CURTAIN-->
<tour-curtain></tour-curtain>


  <div id="underlayer">

    <div id="top"></div>

<!--HEADER NAVBAR-->
<header-component></header-component>


<div id="ct-chapter-top">
    <button type=button id="ct-tc-menu" onclick="openContents()"  aria-label="Open Table of Contents"></button>
    <div class="ct-holder" style="cursor:pointer;" onclick="openContents()">
            <div id="ct-chapter-title">Cycles that Spiral</div>   
            <div id="ct-book-title">Tractatus Ayyew</div>
            <div id="ct-chap-location">Earthen Principle No. 1</div>
            <div id="ct-word-count"><i>1697 words | Book II</i></div>
          </div>
      </div>

<!-- Page Title Section-->

<div id="ct-chapt-graphic" class="background-8">
    <div class="ct-chapter-quote">
      <span style="background-color:var(--nav-bar-accent);
 padding:0.1em 0.2em;">“Observe the way Earth tends its processes towards cycles that spiral.”</span>
    </div>
    <div class="ct-quote-source">
     ― Earthen Ethic No.1
    </div>
  </div>

  <div id="up-arrow"></div>

<div id="ct-main">



<!-- MAIN TEXT CONTENT of the Page
  For footnotes, use these numbers:  ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁰  “ ” ³¹⁰ ²⁶ ⁴⁷ ⁵⁰
-->

<!-- MAIN TEXT CONTENT of the Page
  For footnotes, use these numbers:  ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹ ⁶⁰  “ ” ³¹⁰ ²⁶ ⁴⁷ ⁵⁴
-->

<div class="page-paragraph">
    <p id="58-up"><i>
      THE RUGGED AND THICKLY FORESTED MOUNTAINS OF NORTHERN LUZON have long been the home of the Igorot people.  For untold generations, their society has spun with the cycles of the river, fields and forest in which their communities are neatly nestled.  Each new year and the planting of rice begins with the arrival of the migratory kilin bird. Then, once the crop has turned gold and the kilin have flown back to the forest — the harvest. And then… always a little more. For after the rice has been taken home to dry, it is time for a ritual as old as the harvest itself. One by one, rocks are gathered up from the river to shore up the sides of the field. Stone by stone, the paddy is improved to better capture and disperse the flow of rain down the hillside. Season by season, the garden becomes not just a better home for rice, but a better common home for crabs, frogs, snails, mud fish and more.  Over the generations the soil's fertility increased and the harvests grew in yield.  Igorot society thrived. Rivers remained clean and clear. The forests were respected and the kilin would always return. And then the next cycle would spin —  always a little greener than before.
      
     <a href="#footnotes" title="For an an account of the Igorots remarkable ecological synchrony with the living world around them see: William Henry Scott, Some Calendars of Northern Luzon (American Anthropologist, 1959) 60(3):563 - 570" onclick="openFootnotes(), guidedTour()">⁵⁸</a> </i>
     </p></div>
    <br><br>
     <div id="line" style="margin-bottom: 30px;"></div>
<br><br>
    <div>
    <div class="lead-page-paragraph" id="en-1-1-00">
      TODAY as we seek to green our modern ways, we have much to learn from the way the Igorots managed their energy and matter.  At the heart of their cyclocentric culture is an ancient ecological ethos that can help us make sense of the latest breakthroughs in thermodynamic theory and planetary science.  As we shall see, both the ways of Earth and  Igorots share a geometric resonance.   Both tend their processes towards cycles that spiral and enrich. This vortical pattern underlies not only how the Igorots steadily enriched their ecosystem— but also the way our once barren planet greened. This first aspect of Earth’s cosmological character, shows us the geometric shortcomings of our modern linear and circular processes and guides our green way forward.</div>
      </div>

    <div class="page-paragraph">

      <p id="en-1-1-01">To begin, we must return one more time to the origins of our solar system.</p>


      <p id="en-1-1-02">As we saw in <a href="stellar.html">Earth’s Stellar Story</a>, the planets of the early solar system formed over 5 billion years ago. As each planet coalesced out of drifting stellar debris, it gained a kinetic pattern of energy and matter all its own. To this very moment, each planet’s unique combination of elements, chemistry, orbit, moons, magnetosphere and more continues to unfold. Much as a culture defines and guides all aspects of the life of its people, this cosmological character permeates all a planet’s processes. In particular those that repeat: its cycles — tending them in patterns that are unique to each planet.</p>

<!--Delete this para?-->

      <p id="59-up">In this way, our solar neighborhood has come to be. As Venus, Mars, Earth and all the other planets spun around the Sun, they absorbed and adapted to a never ending torrent of solar energy. Like rain pouring down a hillside into streams, rivers and rapids, the sun’s energy shone down upon each planet’s surface spilling into planetary cycles —  atmospheric flows, ocean currents, tectonic shifts. As the planet’s matter (soil, liquids, gasses) was spun, the resulting cycles were driven by the rigid dictates of thermodynamics.  In ways unique to each planet, the sun’s ever arriving energy was dissipated.<a href="#footnotes" onclick="openFootnotes()">⁵⁹</a></p>



      <p id="en-1-1-03">Over the eons, the cycles on each planet unfolded and the character of each was expressed.</p>

      <p id="60-up">On Earth, one entropic adaptation after another began to accumulate. Just as the Igorots would shore up their terrace walls with new stones every season, each Earthen cycle tended infinitesimally towards an ever improved configuration of matter to capture energy— adding an atom here, a chemical bond there. Like rice terraces capturing, fracturing and spreading out the rain’s downward flow, Earth’s cycles did the same. As one cycle fractured into a thousand, and that into a million more, life began to unfold. Steadily, life-cycles adapted their spin towards ever more concentrated configurations of matter and ever better dissipations of energy.<a href="#footnotes" onclick="openFootnotes()">⁶⁰</a></p>
      
      <p id="en-1-1-04">And, Earth greened.</p>

     <p id="61-up">While, today’s contemporary physicists and philosophers struggle to articulate the connection of life’s emergence within a thermodynamic frame<a href="#footnotes" title="Entropy research by theoretical physicists posit a pattern of adaptive dissipation in the way matter organizes itself in the presence of sustained energy inputs. Meanwhile, parallel breakthroughs in cosmological epistemology help make sense of Earth’s unfolding kinetic character." onclick="openFootnotes()">⁶¹</a>, the Igorots have a single, precise term– and with it, an ecological ethos that governs their cycle-centric culture.</p>

     <p id="en-1-1-05">All aspects of Igorot life and culture are guided by the virtue of <i>ayyew</i><a href="#footnotes" title="See Banayan's work developing a contempory defintion of the concept of Ayyew: Banayan Angway, Cordillera Administrative Region Indigenous Peoples Education Curriculum K-12</i>(Bontoc, Mountain Prov., CAR; Philippines Department of Education, 2014)." onclick="openFootnotes()">³</a>. Men, women, households and communities are admired and respected to the degree in which they embody the principle. Ayyew means to not just just to be in sync with a cycle, but to tend to its spin.</p>

     <p id="en-1-1-06">Children first learn the concept of ayyew at meal time. It is ayyew to finish every grain of rice on one’s plate. Not because it is a waste — rather, because it is a cycle’s crescendo. The last grain represents the culmination of one cycle and the beginning of the next — and an opportunity for a little more. As one cycle ends and another begins, there lies the chance to grow strong so that one can contribute to it: to sow the next seedling, to help with the next harvest, to add a stone to the garden’s wall.</p>

     <p id="en-1-1-07">When there are leftovers from a process (burned rice, banana peels, grass cuttings, etc.) ayyew guides their transition to a subsequent cycle. Rather than simply compost the organic matter, it is more respectable, more ayyew, to feed them to the neighborhood pigs. While both methods lead to fertilizer, the resulting manure is far more concentrated in carbon and microorganisms, making it more effective at spreading over fields and gardens to disperse its nutrients out to the ecosystem at large.</p>

     <p id="en-1-1-08">Finally, ayyew guides the Igorot’s relations with the land. While the destruction of the forest is despised (how can one achieve any richer system of cycling?) the long labor of transitioning a grassy slope to a bio-diverse and fertile ecosystem is admired above all. Rather than the rush of rain down the hillside, instead it is caught in a fractal of zigs and zags. This way the downward flow of the hydrologic cycle (rain-river-evaporation-and-rain-again) is dispersed outwards and ever more equitably throughout the hillside ecosystem. Each terrace is thus enriched— but ‘riches’ not just in yield.   Most especially riches of the planetary kind: ecological stability, resiliency, diversity, vitality and abundance — the very same characteristics that Earth unfurled on our once barren planet.</p>

     <p id="en-1-1-09">Within the deep resonance of the Ayyew ethos and Earth’s cosmological character, lies our first Earthen ethic.</p>

     <p id="en-1-1-10">As we strive to ensure that our human enterprises are green, Earth shows us the way forward. Just as Earth tended its process towards cycles that enrich, so too must we intend with our own. Only when our human processes intend and result in cycles that spiral, can they be considered ecological contributions —  and green.</p>

     <p id="en-1-1-11">Today, we are realizing that our modern processes all too often result in the opposite: greying, ecological depletion. Perhaps, nowhere is this better observed than in our use of plastic. </p>

     <p id="en-1-1-12">In an Igorot community the carbon-based molecules of a grain rice can be cycled from garden, to human, to pig, and back to the garden again indefinitely. Although plastic molecules are also carbon-based, its matter all too often has a one way destination. ‘Single-use’ and ‘disposable’ plastics entirely lack a plan for their circulation. Such linear products and processes are defined by linear goals: incineration, dumping, combustion, etc. In so far as these processes fail to plan for their subsequent cycle, they fail to embody the cyclical ways of Earth.</p>

     <p id="en-1-1-13">To discern the color of our modern processes we must thus first ask about its end: is there an intention for subsequent cycles once the first is complete? Only when our processes have a plan for their next use, and the subsequent ones after that, can they begin to be considered ecological contributions.</p>

     <p id="en-1-1-14">So what then of our circular processes— are they sufficient to be green?</p>

     <p id ="62-up">Today, many products are engineered to be circular — their next life is planned. In this way, PET bottles, carpets and casings are often designed so that when their first use comes to an end they can be recycled into something new. The materials of these products are considered indefinitely reusable ‘technical nutrients’<a href="#footnotes" title="The term ‘technical nutrient’ was first proposed by William McDonough in a theory of circular design that embodies the conceptual geometric problem we highlight here.  See: William McDonough, Michael Braungart (2002), Cradle to Cradle - Remaking the Way We Make Things, North Point Press." onclick="openFootnotes()">⁶²</a>. In this way, modern processes strive to transition to a ‘circular economy’.</p>

     <p id="en-1-1-15">Insofar as such processes contain a plan for the next life of the product, their circularity is an important step towards following Earth’s cyclical ways.</p>

     <p id="en-1-1-16">However, circularity is in and of itself is insufficient.</p>

     <p id="en-1-1-17">After all, over the eons our neighboring planets spun in perfect circles about the sun— yet they did not green.  No matter how much solar energy arrived, Venusian cycles did fracture and cascade. No matter how sustained Mercury's spin, its matter did not spiral into ever more concentrated and complex configurations. No matter how perfect their planetary circles, systemic enrichment failed to take hold.</p>

     <p id="en-1-1-18">As we have seen in the ways of Earth and the Igorots, ecological enrichment requires a tended shift— <i>always something more</i>. Another stone added to the terrace wall. Another atom of carbon added to a protein molecule. While it may be an infinitesimal addition in itself, over an indefinite series of cycles the result is, quite literally, a world of difference.  Indeed, it is the difference between depletion and enrichment, grey and green.</p>

    <p id="en-1-1-19">As such, a plastic bottle may be indefinitely reusable, an economy circular, a company sustainable — yet like the surfaces of Venus and Mars, result in desolation.</p>

    <p id="en-1-1-20">For in the unfolding cyclical systems of the biosphere, there are no perfect circles — only cycles that spiral outwards or inwards, contributing or degrading, enriching or depleting.</p>

    <p id="en-1-1-21">As we strive to ensure our enterprises are green, not only must we plan for the subsequent cycles of our material and energetic processes, we must ensure that each iteration enriches.</p>

    <p id="en-1-1-22">The requisite spiral geometry clear, we can now delve deeper into the vortical character of enrichment itself. In particular, the <i>outwards spin of energy</i> and the <i>inwards spin of our matter</i>—  our next two Earthen ethics.</p>
     </p>
     <br><br><br>
  
    
  </div><!--closes page text content, then loads page curtains:-->



<!--FOOTNOTES SECTION-->

  <div class="footnote-section" style="z-index:8;">

    <div class="footnote-line" style="border-style: dotted; border-color: grey; border-width: 1px; margin-bottom: 20px; width:100%; text-align:left;"></div>

    <div id="footnotes" style="cursor:pointer;display:flex;font-variant-caps: all-petite-caps; color:grey;" onclick="openFootnotes()">
          
      <div id="footnotes-arrow"></div>
      
      <div class="footnotes-title">Chapter Footnotes</div>
    
    </div>

    <div id="footer-reveal-container" style="height:200px;transition:0.4s;" >

      <div id="footnotes-reveal" style="height:200px; overflow-y: clip; transition:0.4s;margin-bottom:0px;transition-delay: 0.4s;">
      
        <a href="#58-up" class="footnote">   
        <div class="footnote-number">58.</div>
        <div class="footnote-text">For an an account of the Igorots remarkable ecological synchrony with the cycles of the living world around them: William Henry Scott, (1959) <i>Some Calendars of Northern Luzon</i>, American Anthropologist 60(3):563 - 570 </div>
        </a>

        <a href="#59-up" class="footnote">   
        <div class="footnote-number">59.</div>
        <div class="footnote-text">Entropy research by theoretical physicists posit a pattern of adaptive dissipation in the way matter organizes itself in the presence of sustained energy inputs. Meanwhile, parallel breakthroughs in cosmological epistemology help make sense of Earth’s unfolding kinetic character. </div>
        </a>

        <a href="#60-up" class="footnote">   
        <div class="footnote-number">60.</div>
        <div class="footnote-text">“The earth is more like an eddy in a river through which flows of matter continuously stream. It is replenished and depleted in a vortical cosmic dance. — Thomas Nail, (2021) <i>A Theory of the Earth</i>
        </div>
        </a>

        <a href="#55-up" class="footnote">   
        <div class="footnote-number">61.</div>
        <div class="footnote-text">Jeremy L. England et al., <i>Dissipative adaptation in driven self-assembly</i>, (Nature Nanotechnology, 2015)  
        </div>
        </a>

        <a href="#56-up" class="footnote">   
        <div class="footnote-number">62.</div>
        <div class="footnote-text">The term ‘technical nutrient’ was first proposed by William McDonough in a theory of circular design that embodies the conceptual geometric problem we highlight here.  See: William McDonough, Michael Braungart (2002), <i>Cradle to Cradle - Remaking the Way We Make Things</i>, North Point Press.   
        </div>
        </a>

        <br><br><br><br>




        </div>
  </div>



    <div id="footnotes-concealer"></div>

    </div><!--Closes footnote section-->

<!-- BOOKNOTES BUTTON-->

<div id="bookNotePalette" class="palette-hidden">
    <!--<span id="closePalette"><img src="../svgs/right-x.svg" alt="Close page button" width="50"></span>  -->
    <div class="highlight-buttons">
        <div id="save-text" class="pallette-text">Save:
        </div>
        <button class="color-btn" onclick="highlightBooknote('green')" style="background:green"></button>
        <button class="color-btn" onclick="highlightBooknote('red')" style="background:red"></button>
        <button class="color-btn" onclick="highlightBooknote('yellow')" style="background:yellow"></button>
        <button class="color-btn" onclick="highlightBooknote('yellow')" style="background:grey" onclick="recreateHighlights()">
        </button>
        
    </div>
    <button id="copyBtn" class="pallette-btn">
        <div class="pallette-text">Copy</div>
    </button> 
    <button id="booknotesBtn" class="pallette-btn" onclick="updateBNResetButton(),openBooknotes(), bookNotesCreator()">
        <div class="pallette-text">Your Booknotes</div>
    </button>
   
    
</div>


   
          
  </div><!--Closes main content block-->



    <!--BOOKNOTES-CURTAIN-->
    <booknotes-curtain></booknotes-curtain>

<!--SEARCH-CURTAIN-->
<search-curtain></search-curtain>

<!--CONTENTS MENU-->
<content-curtain></content-curtain>

<!--SETTINGS-MENU-->
<settings-curtain></settings-curtain>

<!--BOOK PLATE-->
<bookplate-curtain></bookplate-curtain>

<!--ABOUT EARTHBOOK-->
<earthbook-curtain></earthbook-curtain>

<!--SHARE-MENU-->
<share-curtain></share-curtain>

<!--BUY-CURTAIN-->
<buy-curtain></buy-curtain>

<!--ECO-CURTAIN-->
<eco-curtain></eco-curtain>


<!--FOOTER Next Chapter Section: Requires customization-->
  <div id="footer-chapter" style="margin-bottom: 0px;">

    <div class="footer-size">
    
      <div class="footer-left">

       <!-- <div id="footer-icon-left" style="cursor:pointer;" onclick="openFooter()"></div>-->

     
        <div class="next-section">
            <div class="next-sec">Next Chapter:</div>
            <div class="sec-name"><i>2 | The Salmon's Spin</i></div>
        </div>

      </div>
  
      <div class="footer-right">
    
        <a href="energy.html" title="Go to the next chapter" aria-label="Go to the next chapter"><div class="next-button">Next ➔</div></a>

      </div>
    </div>

<!-- CHAPTER FOOTER-->


<chap-foot></chap-foot>



</div><!--underlayer-->

<script>


let currentId = 0;

function generateId() {
    currentId += 1;
    return String(currentId).padStart(3, '0');
}

    
function checkSelectedText() {
    const selection = window.getSelection();

    // Check if any text is selected
    if (!selection.rangeCount || selection.isCollapsed) {
        return;
    }

    const selectedRange = selection.getRangeAt(0);
    const startContainerParent = selectedRange.startContainer.parentNode;
    const endContainerParent = selectedRange.endContainer.parentNode;

    // Check if the selection is within the #ct-main element
    const ctMainElement = document.getElementById('ct-main');
    if (!ctMainElement.contains(startContainerParent) || !ctMainElement.contains(endContainerParent)) {
        return;
    }

    // Check if the selection does not span more than one paragraph
    if (startContainerParent !== endContainerParent) {
        return;
    }

    saveBookNotePalette();
}

document.addEventListener('mouseup', checkSelectedText);
document.addEventListener('touchend', checkSelectedText);



/*
function checkSelectedText() {
    let selectedText = window.getSelection().toString();
    if (selectedText) { // If some text is selected
        saveBookNotePalette();
    }
}*/

document.addEventListener('mouseup', checkSelectedText);
document.addEventListener('touchend', checkSelectedText);



document.addEventListener('mouseup', function(e) {
    let selectedText = window.getSelection().toString();
    if (selectedText) { // If some text is selected
        saveBookNotePalette();
    }
});


let paletteTimeout;

function saveBookNotePalette() {
    const palette = document.getElementById('bookNotePalette');
    palette.style.bottom = '-30px'; // Slide up to show the palette

    // Set a timeout to slide down the palette after 5 seconds
    paletteTimeout = setTimeout(() => {
        palette.style.bottom = '-200px'; // Slide down to hide the palette
    }, 5000);

    // Event listeners to clear the timeout if there's interaction with the palette
    palette.addEventListener('click', clearPaletteTimeout);
    palette.addEventListener('mouseenter', clearPaletteTimeout);
}

function clearPaletteTimeout() {
    clearTimeout(paletteTimeout);
}




document.getElementById('copyBtn').addEventListener('click', function() {
    let selectedText = window.getSelection().toString();
    copyToClipboard(selectedText);
});

function copyToClipboard(text) {
    const textarea = document.createElement('textarea');
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);

    // Change button text and style
    const button = document.getElementById('copyBtn');
    button.style.color = 'green';
    button.textContent = '✓ Copied!';

    // Slide down and hide the palette
    setTimeout(() => {
        const palette = document.getElementById('bookNotePalette');
        palette.style.bottom = '-200px'; // Slide down to hide the palette

        // After an additional second, reset the button text
        setTimeout(() => {
            button.textContent = 'Copy';
            button.style.color = 'var(--text-color)';
        }, 1000);
    }, 800);
}



function highlightBooknote(color) {
    const selection = window.getSelection();

    // Variables for the new requirements
    const highlightColor = color;
    const userNote = "This is an example user note that can be added to the BookNotes for people to read";
    const publicNote = "No";

    // If there's selected text
    if (selection.rangeCount > 0) {
        const selectedRange = selection.getRangeAt(0);
        const span = document.createElement("span");

        // Set the appropriate highlight class based on the color
        switch (highlightColor) {
            case 'green':
                span.classList.add("highlight-green");
                break;
            case 'red':
                span.classList.add("highlight-red");
                break;
            case 'yellow':
                span.classList.add("highlight-yellow");
                break;
            default:
                console.warn(`Unknown highlight color: ${highlightColor}`);
                return; // Exit the function
        }

        span.title = "Click to remove BookNote"; 
        span.alt = "Highlight"; 

        const id = generateId();
        span.dataset.id = id;
        selectedRange.surroundContents(span);

        let startContainerNode = selectedRange.startContainer;
        while (startContainerNode.nodeName !== 'P' && startContainerNode.parentNode !== null) {
            startContainerNode = startContainerNode.parentNode;
        }

        const startContainer = startContainerNode.id;
        const containerHTML = startContainerNode.innerHTML;
        const storedText = selection.toString();

        alert(
            `Start Container: ${startContainer}\n` +
            `Stored Text: ${storedText}\n` +
            `Container HTML: ${containerHTML}`
        );

        const charCount = storedText.length;
        const now = new Date();
        const BNdateTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}T${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        const noteChapter = chapName;

        let bookNotes = getBookNotesFromLocalStorage();

        const bookNote = {
            id,
            book,
            chapNo,
            chapName,
            chaptURL,
            startContainer,
            containerHTML,
            storedText,
            noteChapter,
            charCount,
            BNdateTime,
            highlightColor, // Added
            userNote,       // Added
            publicNote      // Added
        };

        bookNotes.push(bookNote);
        saveBookNotesToLocalStorage(bookNotes);

        console.log('BookNote saved:', bookNote);
        selection.removeAllRanges();
        updateButtonAndPalette();
    }
}


// Sub-function to get existing bookNotes or an empty array if none exist
function getBookNotesFromLocalStorage() {
    try {
        return JSON.parse(localStorage.getItem('bookNotes')) || [];
    } catch (error) {
        console.error('Error reading bookNotes from local storage:', error);
        return [];
    }
}

// Sub-function to save bookNotes to local storage
function saveBookNotesToLocalStorage(bookNotes) {
    try {
        localStorage.setItem('bookNotes', JSON.stringify(bookNotes));
    } catch (error) {
        console.error('Error saving bookNotes to local storage:', error);
    }
}


// Sub-function to update button visuals and behavior post-highlighting

function updateButtonAndPalette() {
    const saveTextDiv = document.getElementById('save-text');
    saveTextDiv.style.color = 'green';
    saveTextDiv.style.fontWeight = 'bold';
    saveTextDiv.textContent = '✓ Saved!';

    setTimeout(() => {
        const palette = document.getElementById('bookNotePalette');
        palette.style.bottom = '-200px';

        setTimeout(() => {
            saveTextDiv.textContent = 'Save:';
            saveTextDiv.style.color = 'var(--thin-border-color)';
            saveTextDiv.style.fontWeight = 'normal';
        }, 1000);
    }, 1000);
}


document.getElementById('highlightSaveButton').addEventListener('click', highlightBooknote);


function removeHighlight(event) {
    const element = event.target;
    
    // Check if the clicked element has any of the highlight classes
    if (element.classList.contains('highlight-green') ||
        element.classList.contains('highlight-red') ||
        element.classList.contains('highlight-yellow')) {
        
        const id = element.dataset.id;

        // Get the bookNotes from local storage
        let bookNotes = JSON.parse(localStorage.getItem('bookNotes')) || [];

        // Find the index of the bookNote with the given id
        const index = bookNotes.findIndex(bookNote => bookNote.id === id);

        if (index !== -1) {
            // If the bookNote was found, remove it
            bookNotes.splice(index, 1);

            // Save the updated array back to local storage
            localStorage.setItem('bookNotes', JSON.stringify(bookNotes));

            console.log('BookNote removal success');
        } else {
            console.log('BookNote removal failed');
        }

        // Replace the span with its text content
        const text = document.createTextNode(element.textContent);
        element.parentNode.replaceChild(text, element);
    }
}

// Add a click event listener to the document
document.addEventListener('click', removeHighlight);


function recreateHighlights() {
    const bookNotes = JSON.parse(localStorage.getItem('bookNotes')) || [];
    alert('Hi!');

    bookNotes.forEach(note => {
        const { containerHTML, startContainer, id } = note;

        if (containerHTML && startContainer && id) {
            try {
                // Find the element by the saved ID
                const container = document.getElementById(startContainer);

                if (container) {
                    container.innerHTML = containerHTML; // Replace the innerHTML with the saved HTML (with highlights)
                } else {
                    console.error('Error: Container element not found for the following book note:', note);
                }
            } catch (err) {
                console.error('An error occurred while recreating highlights for the following book note:', note);
                console.error(err);
            }
        } else {
            console.warn('Warning: Incomplete book note data. Ignoring the following book note:', note);
        }
    });
}
window.onload = function() {
    recreateHighlights();
}

// Make sure this is after recreateSelection
document.addEventListener('click', removeHighlight);


function createElementWithAttributes(type, attributes = {}) {
    const element = document.createElement(type);
    for (const key in attributes) {
        if (attributes.hasOwnProperty(key)) {
            element[key] = attributes[key];
        }
    }
    return element;
}


function bookNotesCreator() {
    // Retrieve existing bookNotes from local storage
    let bookNotes;
    try {
        bookNotes = JSON.parse(localStorage.getItem('bookNotes')) || [];
    } catch (e) {
        console.error('Error parsing bookNotes from localStorage:', e);
        bookNotes = [];
    }

    // Get the book-notes-list div
    const bookNotesListDiv = document.getElementById('book-notes-list');

    // Clear existing children
    bookNotesListDiv.innerHTML = '';

    // Iterate through each book note and create the HTML structure
    bookNotes.forEach((bookNote, index) => {
        const bookNoteDiv = createElementWithAttributes('div', { id: `booknote-${index + 1}` });

        const tcItemDiv = createElementWithAttributes('div', { className: 'tc-item' });

        const chapterNameDiv = createElementWithAttributes('div', {
            className: 'chapter-name-bn',
            textContent: bookNote.storedText
        });

        const wordCountDiv = createElementWithAttributes('div', { className: 'word-count-tc' });

        const chapterLink = createElementWithAttributes('a', { href: bookNote.chaptURL });
        chapterLink.innerHTML = `<i>${bookNote.chapName}</i><br>
        <span style="font-size:small;">${bookNote.book}, Chapt.${bookNote.chapNo}<br>
        ${bookNote.charCount} characters<br>
        ${bookNote.BNdateTime}</span>`;

        wordCountDiv.appendChild(chapterLink);
        tcItemDiv.appendChild(chapterNameDiv);
        tcItemDiv.appendChild(wordCountDiv);
        bookNoteDiv.appendChild(tcItemDiv);
        bookNotesListDiv.appendChild(bookNoteDiv);
    });
}



</script>

</body>
</html>

